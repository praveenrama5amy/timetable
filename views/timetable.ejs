<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= organisation.name %></title>
    <style>
        *{
            margin: 0;
            box-sizing: border-box;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
        .periodAddBtn{
            cursor: pointer;
            border: none;
            background-color: transparent;

        }
        .existHour div{
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
        }
        .existHour div span{
            cursor: pointer;
        }
        .dropdown{
            position: relative;
        }
        .dropdown-content{
            position: absolute;
            margin-top: 60px;
            box-shadow: 1px 1px 5px black;
            min-width: 100px;
            padding: 10px 0px;
            background-color: #fff;
            display: none !important;
        }
        .dropdown:hover .dropdown-content{
            display: block !important;
        }
        .optionBtns{
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .emptyHour{
            cursor: pointer;
        }
    </style>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
</head>
<body>
    <h1 style="text-align: center;text-transform: uppercase;letter-spacing: 10px;font-weight: bold;">
        Time Table
    </h1>
    <center>
        <table border="1px" cellspacing="0px" cellpadding="20px">
            <tr>
                <td>Days/Hours</td>
                <% for( let i = 1; i <= organisation.general.hoursPerDay; i++ ) { %>
                    <td><%= i %></td>
                <% } %>
            </tr>
            <% for( let i = 1; i <= organisation.general.daysPerWeek ; i++ ) { %>
                <tr>
                    <td align="center"><%= i %></td>
                    <% for( let j = 1; j <= organisation.general.hoursPerDay ; j++ ) { %>
                        <% if (organisation.timetable[`I-BCA-A`] != null && organisation.timetable[`I-BCA-A`][`day${i}`] != null && organisation.timetable[`I-BCA-A`][`day${i}`][`hour${j}`] != null) { %>
                            <td align="center" class="existHour">
                                <div>
                                    <%= organisation.timetable[`I-BCA-A`][`day${i}`][`hour${j}`] %>
                                    <div class="dropdown">
                                        <span class="material-symbols-outlined">more_vert</span>
                                        <div class="dropdown-content">
                                            <div class="optionBtns" onclick="deleteHour(this)" hour="<%= j %>" day="<%= i %>"><span class="material-symbols-outlined" style="color: red;">delete</span>Delete</div>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        <% } else { %>
                            <td align="center" class="emptyHour" onclick="addHour(this)" day="<%= i %>" hour="<%= j %>">
                                <div>
                                    <div class="dropdown">
                                        <span class="material-symbols-outlined">add</span>
                                        <div class="dropdown-content" style="margin-top: 0px;">
                                            <div>Hello</div>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        <% } %>
                    <% } %>
                </tr>
            <% } %>
        </table>
    </center>
    <script>
        function deleteHour(e){
            let day = e.getAttribute("day");
            let hour = e.getAttribute("hour")
            let xhttp = new XMLHttpRequest()
            xhttp.open("POST",`/timetable/deleteHour`)
            xhttp.setRequestHeader("Content-Type","application/json")
            xhttp.send(JSON.stringify({
                organ : "ksr",
                class : "I-BCA-A",
                day,
                hour,
            }))
            xhttp.onload = function(){
                console.log(this.response);
            }
        }
        function addHour(e){
            let day = e.getAttribute("day");
            let hour = e.getAttribute("hour")
            let xhttp = new XMLHttpRequest()
            xhttp.open("POST",`/timetable/setHour`)
            xhttp.setRequestHeader("Content-Type","application/json")
            xhttp.send(JSON.stringify({
                organ : "ksr",
                class : "I-BCA-A",
                day,
                hour,
                hourName : prompt("Enter The Hour Name")
            }))
            xhttp.onload = function(){
                console.log(this.response);
            }
        }
        function setHour(day,hour,subject){
            let e = document.querySelector("td[day]")
        }
    </script>
</body>
</html>